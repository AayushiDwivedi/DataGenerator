

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Example: Eight Lonely Rooks &mdash; Data Generator 2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Data Generator 2.0 documentation" href="index.html" />
    <link rel="next" title="Multithreaded Usage" href="Multithreaded.html" />
    <link rel="prev" title="Quick Start" href="QuickStart.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="Multithreaded.html" title="Multithreaded Usage"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="QuickStart.html" title="Quick Start"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Data Generator 2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="example-eight-lonely-rooks">
<h1>Example: Eight Lonely Rooks<a class="headerlink" href="#example-eight-lonely-rooks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-problem">
<h2>The Problem<a class="headerlink" href="#the-problem" title="Permalink to this headline">¶</a></h2>
<p>The eight lonely rooks problem is a simple chess-based problem: place eight rooks on the chess board such that none of the rooks can attack each other. We can use DataGenerator to solve this problem, outputting every possible arrangement of rooks as test data for use elsewhere.</p>
</div>
<div class="section" id="modeling-the-problem-with-scxml">
<h2>Modeling the Problem with SCXML<a class="headerlink" href="#modeling-the-problem-with-scxml" title="Permalink to this headline">¶</a></h2>
<p>To put eight rooks on a chess board such that none attack each other, all eight ranks and all eight files will have one rook on them. Knowing this simplifies the SCXML model we need to describe the problem:</p>
<div class="highlight-python"><pre>&lt;scxml xmlns="http://www.w3.org/2005/07/scxml" xmlns:cs="http://commons.apache.org/scxml"
    version="1.0" initial="start"&gt;

    &lt;state id="start"&gt;
        &lt;transition target="ROOK_ONE" event="ROOK_ONE" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_ONE"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_one" expr="1" /&gt;
            &lt;assign name="rook_file_one" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_TWO" event="ROOK_TWO" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_TWO"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_two" expr="2" /&gt;
            &lt;assign name="rook_file_two" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_THREE" event="ROOK_THREE" cond="${!(rook_file_two == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_THREE"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_three" expr="3" /&gt;
            &lt;assign name="rook_file_three" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_FOUR" event="ROOK_FOUR" cond="${!(rook_file_three == rook_file_two || rook_file_three == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_FOUR"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_four" expr="4" /&gt;
            &lt;assign name="rook_file_four" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_FIVE" event="ROOK_FIVE" cond="${!(rook_file_four == rook_file_three || rook_file_four == rook_file_two || rook_file_four == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_FIVE"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_five" expr="5" /&gt;
            &lt;assign name="rook_file_five" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_SIX" event="ROOK_SIX" cond="${!(rook_file_five == rook_file_four || rook_file_five == rook_file_three || rook_file_five == rook_file_two || rook_file_five == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_SIX"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_six" expr="6" /&gt;
            &lt;assign name="rook_file_six" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_SEVEN" event="ROOK_SEVEN" cond="${!(rook_file_six == rook_file_five || rook_file_six == rook_file_four || rook_file_six == rook_file_three || rook_file_six == rook_file_two || rook_file_six == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_SEVEN"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_seven" expr="7" /&gt;
            &lt;assign name="rook_file_seven" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="ROOK_EIGHT" event="ROOK_EIGHT" cond="${!(rook_file_seven == rook_file_six || rook_file_seven == rook_file_five || rook_file_seven == rook_file_four || rook_file_seven == rook_file_three || rook_file_seven == rook_file_two || rook_file_seven == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="ROOK_EIGHT"&gt;
        &lt;onentry&gt;
            &lt;assign name="rook_rank_eight" expr="8" /&gt;
            &lt;assign name="rook_file_eight" expr="set:{a,b,c,d,e,f,g,h}" /&gt;
        &lt;/onentry&gt;
        &lt;transition target="end" event="end" cond="${!(rook_file_eight == rook_file_seven || rook_file_eight == rook_file_six || rook_file_eight == rook_file_five || rook_file_eight == rook_file_four || rook_file_eight == rook_file_three || rook_file_eight == rook_file_two || rook_file_eight == rook_file_one)}" /&gt;
    &lt;/state&gt;

    &lt;state id="end"&gt;
        &lt;!-- We're done --&gt;
    &lt;/state&gt;
&lt;/scxml&gt;</pre>
</div>
<p>The model assumes that rook number &#8216;n&#8217; will be on the nth rank. A rook&#8217;s placement only has degrees of freedom over the files. Expressed as SCXML, we have a state in the state machine for each rook. Each rook&#8217;s state sets the rook&#8217;s rank to the assumed value and sets the rook&#8217;s file to be any of the eight files. For each rook, it requires that the rook&#8217;s file not equal the files of any of the preceding rooks. During the search over the SCXML state machine, any search branches that assign two rooks the same rank will be pruned by a lack of forward transitions.</p>
</div>
<div class="section" id="solving-with-datagenerator">
<h2>Solving with DataGenerator<a class="headerlink" href="#solving-with-datagenerator" title="Permalink to this headline">¶</a></h2>
<p>The number of solutions to the eight lonely rooks problem is relatively small (8! or 40320 solutions), so multithreaded mode will suffice:</p>
<div class="highlight-python"><pre>import org.finra.datagenerator.consumer.DataConsumer;
import org.finra.datagenerator.distributor.multithreaded.DefaultDistributor;
import org.finra.datagenerator.engine.scxml.SCXMLEngine;
import org.finra.datagenerator.engine.Engine;
import java.io.InputStream;

public class Main {

    public static void main(String[] args) throws Exception {
        //prepare engine
        Engine chartExec = new SCXMLEngine();

        InputStream is = Main.class.getResourceAsStream("/eightLonelyRooks.xml");
        chartExec.setModelByInputFileStream(is);

        chartExec.setBootstrapMin(64);

        //prepare the consumer
        DataConsumer consumer = new DataConsumer();
        consumer.addDataWriter(new RookWriter(System.out));

        //prepare the distributor
        DefaultDistributor dist = new DefaultDistributor();
        dist.setDataConsumer(consumer);
        dist.setThreadCount(10);

        chartExec.process(dist);
    }
}</pre>
</div>
<p>The Main class makes an SCXMLEngine, loads the SCXML state machine seen above from the resources folder, and requests a bootstrap of 64. Ten threads process the 64 Frontiers produced by the bootstrap, overseen by a DefaultDistributor. It uses the standard DataConsumer with a custom DataWriter that produces chess style notation instead of pipe delineated output:</p>
<div class="highlight-python"><pre>import org.finra.datagenerator.consumer.DataPipe;
import org.finra.datagenerator.writer.DataWriter;

import java.io.IOException;
import java.io.OutputStream;

public class RookWriter implements DataWriter {
    private OutputStream os;
    private String[] outTemplate = new String[]{"rook_file_one", "rook_file_two", "rook_file_three", "rook_file_four",
            "rook_file_five", "rook_file_six", "rook_file_seven", "rook_file_eight"};

    public RookWriter(OutputStream os) {
        this.os = os;
    }

    public void writeOutput(DataPipe cr) {
        StringBuilder b = new StringBuilder(1024);
        int index = 1;

        for (String var : outTemplate) {
            if (index &gt; 1) {
                b.append(' ');
            }
            b.append(cr.getDataMap().get(var));
            b.append(String.valueOf(index));
            index++;
        }

        try {
            os.write(b.toString().getBytes());
            os.write("\n".getBytes());
        } catch (IOException e) {

        }
    }
}</pre>
</div>
<p>Some resulting output, 10 lines of many thousand:</p>
<div class="highlight-python"><pre>a1 d2 b3 c4 e5 g6 h7 f8
a1 d2 b3 c4 e5 h6 f7 g8
a1 d2 b3 c4 e5 h6 g7 f8
a1 g2 b3 c4 d5 e6 f7 h8
a1 g2 b3 c4 d5 e6 h7 f8
a1 d2 b3 c4 f5 e6 g7 h8
a1 g2 b3 c4 d5 f6 e7 h8
a1 g2 b3 c4 d5 f6 h7 e8
a1 d2 b3 c4 f5 e6 h7 g8
a1 g2 b3 c4 d5 h6 e7 f8</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Example: Eight Lonely Rooks</a><ul>
<li><a class="reference internal" href="#the-problem">The Problem</a></li>
<li><a class="reference internal" href="#modeling-the-problem-with-scxml">Modeling the Problem with SCXML</a></li>
<li><a class="reference internal" href="#solving-with-datagenerator">Solving with DataGenerator</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="QuickStart.html"
                        title="previous chapter">Quick Start</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Multithreaded.html"
                        title="next chapter">Multithreaded Usage</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/BasicExample.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="Multithreaded.html" title="Multithreaded Usage"
             >next</a> |</li>
        <li class="right" >
          <a href="QuickStart.html" title="Quick Start"
             >previous</a> |</li>
        <li><a href="index.html">Data Generator 2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, DataGenerator Contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>